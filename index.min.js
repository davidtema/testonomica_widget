const EVENT_FINISH="finish",EVENT_RESIZE="resize",EVENT_LOAD="load";class TncEventDispatcher{constructor(){this.listeners={}}addEventListener(t,e){this.listeners[t]=e}dispatchEvent(t){this.listeners[t.type]&&this.listeners[t.type](t.detail)}}class Widget{constructor(t,e,n){this.block=t,this.config=e,this.dispatcher=n}init(){const t=this.config,e={token:t.token,showResultAfterLoad:t.showResultAfterLoad},n=document.createElement("div");n.innerHTML=block.innerHTML,block.after(n),this.block.innerHTML="";const i=document.createElement("iframe");i.src=t.host+"/tests/widget/"+t.testId+"/?"+new URLSearchParams(e).toString(),i.loading="lazy",i.scrolling="no",i.style.border="none",i.style.height="auto",i.style.width="100%",i.style.display="none",this.block.appendChild(i),this.dispatcher.addEventListener("load",(function(t){n.remove(),i.style.display="block"})),this.dispatcher.addEventListener("resize",(function(t){const e=parseInt(t.frameHeight);i.style.height=e+"px"}))}addEventListener(t,e){this.dispatcher.addEventListener(t,e)}}function boolParam(t,e){return null===t?e:"1"===t||1===t||!0===t||"true"===t?1:0}function stingParam(t,e){return null===t?e:t}function configure(t){const e=t.getAttribute("data-test");if(!e)throw new Error('Error no test specified (e.g data-test="102").');const n=t.getAttribute("data-token");if(!n)throw new Error('Error no token specified (e.g data-token="PUBLIC_TOKEN").');const i=boolParam(t.getAttribute("data-show-result-after-load"),1),o=stingParam(t.getAttribute("data-init"),"auto",["auto"]);if(-1===["auto","manual"].indexOf(o))throw new Error("Unsupported value init: "+o);return{host:t.getAttribute("data-host")??"https://testonomica.com",testId:e,token:n,showResultAfterLoad:i,init:o}}const block=document.getElementById("testonomica_app");if(!block)throw new Error('Error tag id "testonomica_app" not found.');const config=configure(block),dispatcher=new TncEventDispatcher;window.onmessage=function(t){if(t.origin===config.host&&t.data.hasOwnProperty("name")){const e=t.data.name;if("frameHeight"===e)return void dispatcher.dispatchEvent(new CustomEvent("resize",{detail:{frameHeight:t.data.frameHeight}}));"finish"===e&&dispatcher.dispatchEvent(new CustomEvent("finish",{detail:{key:t.data.key}})),"load"===e&&dispatcher.dispatchEvent(new CustomEvent("load"))}};const tncw=new Widget(block,config,dispatcher);"auto"===config.init&&tncw.init(),window.tncw=tncw;
