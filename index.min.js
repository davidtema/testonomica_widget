const EVENT_FINISH="finish",EVENT_RESIZE="resize";class TncEventDispatcher{constructor(){this.listeners={}}addEventListener(t,e){this.listeners[t]=e}dispatchEvent(t){this.listeners[t.type]&&this.listeners[t.type](t.detail)}}class Widget{constructor(t,e,n){this.block=t,this.config=e,this.dispatcher=n}init(){const t=this.config,e={token:t.token,showResultAfterLoad:t.showResultAfterLoad},n=document.createElement("iframe");n.src=t.host+"/tests/widget/"+t.testId+"/?"+new URLSearchParams(e).toString(),n.loading="lazy",n.scrolling="no",n.style.border="none",n.style.height="auto",n.style.width="100%",this.block.appendChild(n),this.dispatcher.addEventListener("resize",(function(t){const e=parseInt(t.frameHeight);n.style.height=e+"px"}))}addEventListener(t,e){this.dispatcher.addEventListener(t,e)}}function boolParam(t,e){return null===t?e:"1"===t||1===t||!0===t||"true"===t?1:0}function stingParam(t,e){return null===t?e:t}function configure(t){const e=t.getAttribute("data-test");if(!e)throw new Error('Error no test specified (e.g data-test="102").');const n=t.getAttribute("data-token")??null,i=boolParam(t.getAttribute("data-show-result-after-load"),1),s=stingParam(t.getAttribute("data-init"),"auto",["auto"]);if(-1===["auto","manual"].indexOf(s))throw new Error("Unsupported value init: "+s);return{host:t.getAttribute("data-host")??"https://testonomica.com",testId:e,token:n,showResultAfterLoad:i,init:s}}const block=document.getElementById("testonomica_app");if(!block)throw new Error('Error tag id "testonomica_app" not found.');const config=configure(block),dispatcher=new TncEventDispatcher;window.onmessage=function(t){if(t.origin===config.host&&t.data.hasOwnProperty("name")){const e=t.data.name;if("frameHeight"===e)return void dispatcher.dispatchEvent(new CustomEvent("resize",{detail:{frameHeight:t.data.frameHeight}}));"finish"===e&&dispatcher.dispatchEvent(new CustomEvent("finish",{detail:{key:t.data.key}}))}};const tncw=new Widget(block,config,dispatcher);"auto"===config.init&&tncw.init(),window.tncw=tncw;
